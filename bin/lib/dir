#!/usr/bin/env bash

# Load dir configuration
config="$HOME/.config/dir/list"

# Arg parsing
if [[ $# -eq 1 ]] && [[ $1 == 'cfg' ]]; then
	$EDITOR $config
	exit 0
fi

declare -A folders
while IFS= read -r line
do
  numChars=${#line}
  if [[ $numChars -eq 0 ]]; then
	  continue
  else
	  firstChar=${line::1}
	  ## support comments
	  if [[ "$firstChar" == "#" ]]; then
		  continue
	  fi

	  # horrible solution, but bash affords me little
	  # here. I may have constructed my IFS in a non
	  # idiomatic way. Please send PR if you know the way.
	  name=$(echo "$line" | cut -d'|' -f1)
	  value=$(echo "$line" | cut -d'|' -f2)
	  
	  folders[$name]=$value
  fi
done < "$config"

function getList() {
	for name in "${!folders[@]}"
		do echo "$name"
	done
}

list=`getList`

choice=`echo "$list" | fzf --height 40%`
result=$?

if [[ -n $choice ]]; then
	echo "${folders[$choice]}"
fi

exit $?
